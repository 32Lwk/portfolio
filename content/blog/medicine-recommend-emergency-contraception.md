---
title: "緊急避妊薬対応機能の実装 - 性被害を含む緊急避妊薬に関する質問への適切な対応"
description: "性被害を受けた方に対して、72時間以内の緊急避妊薬の服用の重要性を強調し、対面診療とオンライン診療の案内、心理的サポートと警察への相談の案内を提供する機能の実装について"
date: "2026-01-16"
category: "プロジェクト"
tags: ["医薬品相談ツール", "医療AI"]
author: "川嶋宥翔"
featured: false
---

# 緊急避妊薬対応機能の実装 - 性被害を含む緊急避妊薬に関する質問への適切な対応

性被害を受けた方に対して、72時間以内の緊急避妊薬の服用の重要性を強調し、適切な情報とサポートを提供する機能を実装しました。この記事では、実装の背景と、開発者としての想いについて詳しく解説します。

## 開発の背景

### 社会的責任としての実装

医療情報システムとして、**社会的責任**を果たす必要があると考えました。緊急避妊薬に関する質問は、時間が非常に重要であり、適切な情報を迅速に提供する必要があります。

### 実装の動機

ドラッグストアでの現場経験を通じて、緊急避妊薬に関する質問が実際にあることを知りました。しかし、市販薬（OTC薬）の相談を承るシステムとして、処方薬である緊急避妊薬の処方はできません。

そこで、**適切な医療機関への案内と、時間の重要性を強調する情報提供**を実装することにしました。

## 実装の詳細

### 1. 性被害の検出

```python
# src/services/counseling/counseling_generator.py
sexual_assault_keywords = [
    "レイプ", "れいぷ", "rape", "強姦", "ごうかん",
    "性被害", "せいひがい", "性的被害", "せいてきひがい",
    "性暴力", "せいぼうりょく", "性的暴力", "せいてきぼうりょく"
]

def detect_sexual_assault(user_text):
    """
    性被害の検出
    
    Args:
        user_text: ユーザーの入力テキスト
    
    Returns:
        is_sexual_assault: 性被害が検出されたか
    """
    user_text_lower = user_text.lower()
    return any(keyword.lower() in user_text_lower for keyword in sexual_assault_keywords)
```

### 2. 緊急避妊薬に関する質問の検出

```python
emergency_contraception_keywords = [
    "アフターピル", "あふたーぴる", "afterpill", "after pill",
    "ノルレボ", "のるれぼ", "norlevo",
    "レボノルゲストレル", "れぼのるげすとれる", "levonorgestrel",
    "緊急避妊", "きんきゅうひにん", "緊急避妊薬", "きんきゅうひにんやく",
    "緊急避妊ピル", "きんきゅうひにんぴる",
    "避妊に失敗", "ひにんにしっぱい", "避妊失敗", "ひにんしっぱい",
    "避妊できません", "ひにんできません", "避妊できなかった", "ひにんできなかった",
    "避妊出来なかった", "ひにんできなかった", "避妊出来ません", "ひにんできません",
    "コンドームが破れ", "こんどむが破れ", "コンドーム破れ", "こんどむ破れ",
    "コンドームが破れた", "こんどむが破れた", "コンドーム破れた", "こんどむ破れた"
]

def detect_emergency_contraception(user_text):
    """
    緊急避妊薬に関する質問の検出
    
    Args:
        user_text: ユーザーの入力テキスト
    
    Returns:
        is_emergency_contraception: 緊急避妊薬に関する質問が検出されたか
    """
    user_text_lower = user_text.lower()
    return any(keyword.lower() in user_text_lower for keyword in emergency_contraception_keywords)
```

### 3. 性被害を受けた方への専用プロンプト

```python
sexual_assault_prompt = f"""
あなたは医薬品相談AIアシスタントです。性被害を受けた方に対して、親身で適切な情報とサポートを提供してください。

【ユーザーの状況】
{user_text}

【会話履歴】
{history_text if history_text else "（会話履歴がありません）"}

【性被害を受けた方への重要な情報】

1. **緊急避妊薬（アフターピル）について**
 - 性行為から72時間（3日）以内に服用することで、高い確率で妊娠を避けることが期待できます
 - できるだけ早く服用することが効果的です
 - 日本で認可されている緊急避妊薬は「ノルレボ」「レボノルゲストレル」で、性行為から72時間以内に1錠服用します
 - 必ず医療機関で発行される処方箋が必要です

2. **医療機関への相談**
 - 産婦人科を受診し、緊急避妊薬の処方を受けることができます
 - 性感染症の検査も受けることをお勧めします
 - 2019年より、オンライン診療も可能です（産婦人科医または必要な研修を受けた医師が初診からオンライン診療を行うことができます）

3. **心理的サポート**
 - 性暴力被害者支援センターや相談窓口があります
 - 一人で抱え込まず、信頼できる人や専門家に相談することが大切です

4. **警察への相談**
 - 希望する場合は、警察への相談も可能です
 - 証拠保全のため、できるだけ早く相談することが重要です

5. **その他の支援**
 - 性暴力被害者支援センター（全国共通ダイヤル：#8103）
 - 各都道府県の相談窓口

【返信の要件】
- **親身で共感的なトーン**: ユーザーの状況に寄り添い、理解を示す（1-2文）
- **時間の重要性を強調**: 72時間以内の緊急避妊薬の服用の重要性を説明
- **医療機関への相談を促す**: 産婦人科への相談を案内し、性感染症の検査も受けることを推奨
- **心理的サポートの案内**: 性暴力被害者支援センターなどの相談窓口を案内
- **警察への相談の案内**: 希望する場合は警察への相談も可能であることを伝える
- **システムの制限の説明**: 当システムは市販薬（OTC医薬品）の相談を承っており、処方薬の処方はできないことを説明
- **安心感を与える**: ユーザーが適切な支援を受けられるよう、親身にサポートする
- **応答長さ**: 400-500文字程度（重要な情報を含めるため、やや長めでも可）
- **マークダウン記号の使用禁止**: **や*などのマークダウン記号は使用せず、通常のテキストで返信してください

【返信を生成してください】
"""
```

### 4. 緊急避妊薬専用のプロンプト

```python
emergency_contraception_prompt = f"""
あなたは医薬品相談AIアシスタントです。緊急避妊薬に関する質問に対して、親身で適切な情報を提供してください。

【ユーザーの質問】
{user_text}

【会話履歴】
{history_text if history_text else "（会話履歴がありません）"}

【緊急避妊薬に関する重要な情報】
- **名称**: アフターピル、緊急避妊ピルとも呼ばれます
- **目的**: 望まない妊娠の可能性がある場合（性行為や性被害など）に使用
- **有効性**: 性行為から72時間（3日）以内に服用することで、高い確率で妊娠を避けることが期待できます
- **効果**: 主に排卵を遅らせるなどの作用により緊急的に妊娠の成立を防ぎます
- **時間の重要性**: 性交からできるだけ早く服用することが効果的で、早く服用した方が効果が高いことがわかっています。72時間を超えてから服用すると効果は大きく落ちますが、効果が全く得られないわけではありません
- **認可されている薬**: 日本で認可されている緊急避妊薬は「ノルレボ」「レボノルゲストレル（ノルレボのジェネリック医薬品）」で、性行為から72時間以内に1錠服用します

【取得方法】
緊急避妊薬は必ず医療機関で発行される処方箋が必要です。以下の2つの方法があります：

1. **対面診療**
 - 産婦人科及び必要な研修を受けた医師に診察を受ける
 - 処方箋原本を薬局に持参
 - 薬局で必要な研修を受けた薬剤師との対面服用（処方は1錠のみ）

2. **オンライン診療（緊急避妊に関するオンライン診療）**
 - 2019年より、産婦人科医又は厚生労働省が指定する研修を受講した医師が、初診からオンライン診療を行うことができるようになりました
 - 産婦人科及び必要な研修を受けた医師に診察を受ける
 - 医療機関から薬局へ処方箋情報の送付・情報提供
 - 薬局において、必要な研修を受けた薬剤師との対面服用（処方は1錠のみ）
 - 薬局から処方医へ、服用したことを情報提供

**重要**: いずれの場合も、3週間後に産婦人科医による対面診療を受けてください。

【返信の要件】
- **親身で共感的なトーン**: ユーザーの状況に寄り添い、理解を示す（1-2文）
- **時間の重要性を強調**: 72時間以内の服用の重要性、できるだけ早く服用することが効果的であることを説明
- **具体的な取得方法の案内**: 対面診療とオンライン診療の両方の選択肢を説明
- **システムの制限の説明**: 当システムは市販薬（OTC医薬品）の相談を承っており、処方薬の処方はできないことを説明
- **専門家への相談を促す**: 産婦人科医への相談を案内し、3週間後の対面診療の重要性も伝える
- **安心感を与える**: ユーザーが適切な医療機関にアクセスできるよう、親身にサポートする
- **応答長さ**: 300-400文字程度（重要な情報を含めるため、やや長めでも可）
- **マークダウン記号の使用禁止**: **や*などのマークダウン記号は使用せず、通常のテキストで返信してください

【返信を生成してください】
"""
```

## 開発者としての想い

### 1. 社会的責任

医療情報システムとして、**社会的責任**を果たす必要があると考えました。緊急避妊薬に関する質問は、時間が非常に重要であり、適切な情報を迅速に提供する必要があります。

### 2. ユーザーへの配慮

性被害を受けた方に対して、**親身で共感的な対応**を心がけました。技術的な正確性だけでなく、ユーザーの心情に寄り添うことが重要だと考えています。

### 3. システムの制限の明確化

市販薬（OTC薬）の相談を承るシステムとして、処方薬である緊急避妊薬の処方はできません。しかし、**適切な医療機関への案内と、時間の重要性を強調する情報提供**を実装することで、ユーザーをサポートできると考えました。

## 実装の課題と解決

### 1. プロンプトの設計

親身で共感的なトーンを保ちながら、正確な情報を提供するプロンプトの設計に苦労しました。

**解決策**: 
- 複数のプロンプトテンプレートを作成
- ユーザーフィードバックを基に改善
- マークダウン記号の削除により、より自然な応答を実現

### 2. 情報の正確性

緊急避妊薬に関する情報の正確性を確保する必要がありました。

**解決策**: 
- 厚生労働省のガイドラインを参照
- 医療機関への案内を明確に
- 3週間後の対面診療の重要性を強調

### 3. ユーザーの心情への配慮

性被害を受けた方に対して、適切な対応を心がけました。

**解決策**: 
- 親身で共感的なトーンを保つ
- 心理的サポートの案内を追加
- 警察への相談の案内を追加

## まとめ

緊急避妊薬対応機能の実装により、性被害を受けた方に対して、適切な情報とサポートを提供できるようになりました。72時間以内の緊急避妊薬の服用の重要性を強調し、対面診療とオンライン診療の案内、心理的サポートと警察への相談の案内を提供しています。

**「人や社会に影響を与えるシステムは、誤ってはいけない」** - この信念を胸に、今後も開発を続けていきます。
