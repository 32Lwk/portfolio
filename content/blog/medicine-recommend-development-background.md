---
title: チャット型医薬品相談ツール開発の背景と動機
description: ドラッグストアでの現場経験から生まれた、高齢者を中心としたお客様の課題を解決するための開発プロジェクトの始まりについて
date: '2025-10-15'
category: プロジェクト
tags:
  - 医薬品相談ツール
  - 開発記録
author: 川嶋宥翔
featured: false
hidden: false
---

# チャット型医薬品相談ツール開発の背景と動機

ドラッグストアでの現場経験を通じて、高齢者を中心としたお客様が適切な医薬品を選択することの難しさを実感しました。この記事では、開発プロジェクトの始まりと、解決したい課題について詳しく解説します。

## 現場で感じた課題

### 1. 症状の説明が難しい

高齢者の方々は、自分の症状を正確に言葉で表現することが難しい場合が多くありました。特に以下のような状況が頻繁に発生していました：

- 「なんとなく調子が悪い」という曖昧な表現
- 複数の症状が同時に存在する
- 症状の程度や期間を正確に伝えられない

### 2. 専門知識の必要性

一般用医薬品の選択には、以下のような専門的な知識が必要です：

- 症状と医薬品の効能効果のマッチング
- 年齢制限や禁忌事項の確認
- 成分の重複や相互作用のチェック
- 生活状況（妊娠中、授乳中など）の考慮

これらの知識を一般の方が持つことは難しく、専門家（登録販売者・薬剤師）のサポートが必要です。

### 3. 相談時間の制約

店舗での相談には時間的な制約があり、すべてのお客様に十分な時間をかけることが難しい状況でした。特に混雑時には、簡潔な相談しかできない場合もありました。

### 4. 現場でよくあるパターン（開発で反映した例）

[medicine-recommend-system](https://github.com/32Lwk/medicine-recommend-system) のREADMEや開発履歴から、現場のニーズがその後の機能にどうつながったかを挙げます。

- **曖昧な表現**: 「なんとなく」「調子が悪い」といった入力には、症状数・入力文字数・NLU信頼度を組み合わせた曖昧入力検出を実装し、推奨結果の上部に「症状をできるだけ具体的に」といった案内を表示するようにしました（[ハイブリッド推奨](/blog/medicine-recommend-hybrid-system)・[開発ジャーニー](/blog/medicine-recommend-development-journey)参照）。
- **方言・地域差**: 「しんどい」「にえる」「えらい」など地域差のある表現は、[方言対応機能](/blog/medicine-recommend-dialect-support)で標準語の症状に写してから推奨するようにしました（和歌山県データ利活用コンペでの実利用がきっかけの一つです）。
- **医薬品以外の相談**: 実際の利用では「恋の悩み」のような感情的な相談も入力されます。和歌山県データ利活用コンペで「恋の病」と入力されてエラーになった経験から、[カウンセリングフロー](/blog/medicine-recommend-counseling-feature)を設け、感情的症状を適切に受け止める設計にしました（詳しくは[開発ジャーニー](/blog/medicine-recommend-development-journey)の「失敗から学んだこと」を参照）。

## 解決へのアプローチ

これらの課題を解決するため、以下のようなシステムの開発を開始しました：

### 1. チャット形式による自然な対話

症状を自然な文章で入力できるチャット形式を採用し、専門用語を知らなくても相談できるようにしました。

### 2. 登録販売者の相談プロセスを再現

実際の登録販売者が行う相談プロセスを分析し、それをシステム化しました：

1. **症状の聞き取り**: ユーザーの入力から症状を抽出
2. **生活状況の確認**: 年齢、妊娠・授乳中、既往歴などを考慮
3. **適切な医薬品の推奨**: 症状と生活状況に基づいて最適な医薬品を提案
4. **注意事項の説明**: 用法用量や注意事項を分かりやすく説明

### 3. 安全性の確保

医療情報システムとして、以下の安全性対策を実装しました：

- **入力検証**: 症状の妥当性チェック
- **出力制限**: 推奨範囲の制限（一般用医薬品のみ）
- **警告表示**: 専門家への相談を促す仕組み
- **ログ管理**: すべての相談内容を記録

## 技術スタック

- **バックエンド**: Flask (Python 3.11)
- **データベース**: PostgreSQL (Neon)
- **AI**: OpenAI GPT-4, DeepL API
- **デプロイ**: GCP Cloud Run
- **セッション管理**: PostgreSQLベースのマルチインスタンス対応

## 開発の経過とREADMEとの対応（簡易年表）

[medicine-recommend-system](https://github.com/32Lwk/medicine-recommend-system) のREADMEおよび[開発の軌跡と学び](/blog/medicine-recommend-development-journey)に基づく、開発の流れの要約です。

| 時期 | 主な内容 |
|------|-----------|
| **2025年10月** | 開発本格化。症状検出・医薬品マッチング・ルールベース推奨から開始。多言語対応・UI/UX・管理者機能（フィードバック・セッション管理）を実装（10月のみで205コミット）。 |
| **2025年11月** | ハイブリッド推奨（ルールベース主軸＋LLMはNLU等に限定）、マルチインスタンス対応（PostgreSQLでセッション共有）、二段階スコアリングでAPI約67%削減、漢方34種のルール統合。 |
| **2025年12月** | トリアージ・カウンセリング・店舗案内・緊急事案検出・方言対応・診断名検出・成分重複チェック・イースターエッグなどを実装。本番利用で得た「恋の病」の事例をきっかけにカウンセリングフローを強化。 |
| **2026年1月** | アクセシビリティ（WCAG AA、音声読み上げ・文字サイズ・折りたたみ）、スコアリング改善、緊急避妊薬対応、オンボーディング改善など。 |
| **2026年2月** | GCP Cloud Run・Neon PostgreSQLへ移行、SRPに基づくリファクタリング、ブロック時の案内メッセージのDB永続化、不適切ワード拡張。 |

開発の初期段階（2025年10月）は、基本的な症状検出・医薬品データベースとのマッチング・シンプルなルールベース推奨から始まり、その後LLMをNLUや質問生成に限定したハイブリッド構成へ発展しています。失敗事例や設計意図の詳細は[開発の軌跡と学び](/blog/medicine-recommend-development-journey)にまとめています。

## 今後の展望

現在はβ版として運用していますが、以下の改善を予定しています：

1. **精度向上**: より多くの相談事例データの蓄積
2. **UI/UX改善**: より直感的な操作感の実現
3. **多言語対応**: 外国人の方にも利用しやすく
4. **専門家連携**: 薬剤師・登録販売者との連携機能

## 開発者としての想い

### 「システムを誤らせない設計」へのこだわり

このプロジェクトを通じて、**「人や社会に影響を与えるシステムは、誤ってはいけない」**という信念を改めて実感しました。

医療情報システムとして、単に「動く」だけでなく、**「誤らせない」設計**を徹底することが重要です。特に、以下の点を重視しています：

1. **LLMや人の判断に「丸投げしない」**: 判断が結果に直結する領域では、ルール・制約・例外処理をコードで明示する
2. **「正しく動く」だけでなく「誤らせない」**: 正常系よりも異常系・境界条件・誤入力・想定外入力を先に考える
3. **属人化しない仕組みを作る**: 一人の理解に依存しないよう責務分離・ログ・テスト・READMEを重視

### 現場経験からの学び

ドラッグストアでの現場経験を通じて、**ユーザーの実際のニーズ**を理解することができました。高齢者の方々がどのように症状を表現するか、どのような課題があるか、現場で直接感じることができたのは、非常に貴重な経験でした。

### 継続的な改善への取り組み

開発開始から10ヶ月間、ほぼ毎日機能追加・改善を行ってきました。この継続的な改善の積み重ねが、システムの価値を大きく向上させたと感じています。

## まとめ

医療×AI分野での開発は、技術的な難しさだけでなく、安全性と倫理的な配慮が重要です。このプロジェクトを通じて、「システムを誤らせない設計」の重要性を改めて実感しました。

**「人や社会に影響を与えるシステムは、誤ってはいけない」** - この信念を胸に、今後も現場の声を大切にしながら、より良いシステムの構築を目指していきます。
